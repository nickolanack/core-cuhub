{
    "type": "WizardScriptElement",
    "config": {
        "name": "My Custom Script",
        "script": "return function(viewer, element, parentModule){\nvar isLoaded=false;\n\n\n\nvar activeDayEl=null;\n\nvar todayStr = (new Date()).toISOString().split('T')[0];\n\nif(!application.getNamedValue(\"selectedDay\")){\n    application.setNamedValue(\"selectedDay\", todayStr);\n    application.setNamedValue(\"dateFilter\", {dates:[todayStr]});\n}\nvar renderList=function(dates){\n                var listView=viewer.getChildView('content',0);\n                 if(listView){\n                     \n                    var dateList=[];\n                    Object.keys(dates).forEach(function(key){\n                        dateList.push({\"date\":key,\"events\":dates[key]})\n                    })\n                     dateList.sort(function(a,b){\n                         return a.date>b.date?1:-1;\n                     });\n                     listView.redraw(null, dateList);\n                 }\n            };\n            \n            \nvar setSelectedDay=function(day, el){\n    \n            application.setNamedValue(\"selectedDay\", day);\n            application.setNamedValue(\"dateFilter\", {dates:[day]});\n            \n            if(activeDayEl){\n                activeDayEl.removeClass(\"active\");\n            }\n            activeDayEl=el;\n            el.addClass(\"active\");\n}\n\nvar redrawSiblingList=function(){\n    var start=new Date(application.getNamedValue(\"selectedDay\"))\n    var range=[start, new Date(start.valueOf()+(1000*3600*24))];\n   \n};\n\n(new CalendarModule({\n    data:function(range, callback){\n        \n        EventList.SharedInstance(function(list){\n            \n            var data={};\n            list.getAllEvents().forEach(function(e){\n                \n                if(e.hasEventDate()){\n                    var d=e.getEventDateStr();\n                    if(!data[d]){\n                        data[d]=[];\n                    }\n                    data[d].push(e);\n                }else if(e.hasDate()){\n                    var d=e.getDateStr();\n                    if(!data[d]){\n                        data[d]=[];\n                    }\n                    data[d].push(e);\n                }\n            })\n            callback(data);\n        })\n    },\n    events:{\n        selectDay:function(day, el){\n            console.log('Select day:'+day);\n            \n            var controller=application.getNamedValue('navigationController');\n        \n        \n            setSelectedDay(day, el);\n            \n            var view=controller.getCurrentView()\n            if(view.view==\"Calendar\"){\n               controller.navigateTo(\"Date\", \"Main\"); \n               return;\n            }\n            \n            redrawSiblingList();\n            \n            \n            \n            \n            \n        }\n    },\n    dayElFormatter:function(el, day){\n        \n        if(application.getNamedValue(\"selectedDay\")===day){\n    \n                setSelectedDay(day, el);   \n                redrawSiblingList();\n        }\n        \n        \n    },\n    eventDataFormatter:function(data, dayEl){\n                 var el=dayEl.appendChild(new Element('span',{\"class\":'events'}))\n                 var renderDataItem=function(d){\n                       var dataEl=el.appendChild(new Element('span',{\"class\":\"event-data\",\"data-label\":d.getName()})); \n                       dataEl.addClass(\"calendar-item-\"+(d.getType().split('.').pop()))\n                    }\n\n                \n                if(data.length){\n                    data.forEach(function(str){\n                        renderDataItem(str);\n                    })\n                    \n                }\n                \n                \n                \n                \n                \n               \n                \n                \n            }\n            \n})).load(null, element, null);\n\n\nviewer.addEvent('load:once',function(){\n   isLoaded=true; \n});\n\n}",
        "description": "Info about my custom script"
    }
}